"use strict";angular.module("zeddbApp",["ngResource","restangular","ui.bootstrap","$strap.directives"]).config(["$routeProvider","$locationProvider","RestangularProvider",function(a,b,c){a.when("/releases/:id",{templateUrl:"views/releasedetails.html",controller:"ReleaseDetailCtrl"}).when("/releases",{templateUrl:"views/release.html",controller:"ReleaseCtrl"}).when("/releases/new/:name",{templateUrl:"views/releasedetails.html",controller:"ReleaseDetailCtrl"}).when("/subscribers/",{templateUrl:"views/subscriber.html",controller:"SubscriberCtrl"}).when("/subscribers/:id",{templateUrl:"views/subdetails.html",controller:"SubdetailsCtrl"}).when("/subscribers/new/subscriber",{templateUrl:"views/subdetails.html",controller:"SubdetailsCtrl"}).when("/contacts/",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).when("/contacts/:id",{templateUrl:"views/contactdetails.html",controller:"ContactdetailsCtrl"}).when("/contacts/new/contact",{templateUrl:"views/contactdetails.html",controller:"ContactdetailsCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!1),c.setBaseUrl("http://db.4zzzfm.org.au/api/v1"),c.setRestangularFields({id:"library_no",route:"restangularRoute"})}]).factory("ReleaseService",["$resource","$http","$rootScope",function(a){return a("http://db.4zzzfm.org.au/api/v1/releases/:id",{id:"@id"},{update:{method:"PUT"}})}]).factory("GenresService",function(a){return a("http://db.4zzzfm.org.au/api/v1/genres")}).factory("ThemesService",function(a){return a("http://db.4zzzfm.org.au/api/v1/themes")}).factory("DepartmentsService",function(a){return a("http://db.4zzzfm.org.au/api/v1/departments")}).factory("InterestsService",function(a){return a("http://db.4zzzfm.org.au/api/v1/interests")}).factory("SkillsService",function(a){return a("http://db.4zzzfm.org.au/api/v1/skills")}).factory("ProgramsService",function(a){return a("http://db.4zzzfm.org.au/api/v1/programs")}).factory("SubtypesService",function(a){return a("http://db.4zzzfm.org.au/api/v1/subtypes")}).factory("SubService",["$resource","$http","$rootScope",function(a){return a("http://db.4zzzfm.org.au/api/v1/subscribers/:id",{id:"@subnumber"},{update:{method:"PUT"}})}]).factory("ContactService",["$resource","$http","$rootScope",function(a){return a("http://db.4zzzfm.org.au/api/v1/contacts/:id",{id:"@contact_no"},{update:{method:"PUT"}})}]).factory("SubsBandService",function(a){return a("http://db.4zzzfm.org.au/api/v1/subscribers/band/:name",{name:"@subbandname"},{update:{method:"PUT"}})}).directive("ngBlur",function(){return function(a,b,c){b.bind("blur",function(){a.$apply(c.ngBlur)})}}).directive("ngUppercaseInput",function(){return{require:"ngModel",link:function(a,b,c,d){var e=function(a){if(a){var b=a.toUpperCase();return b!==a&&(d.$setViewValue(b),d.$render()),b}};d.$parsers.push(e),e(a[c.ngModel])}}}),angular.module("zeddbApp").controller("MainCtrl",["$scope","$http","$location","limitToFilter",function(a,b,c){a.search=function(){c.path("/releases")},a.isCollapsed=!0}]),angular.module("zeddbApp").controller("ReleaseCtrl",["$rootScope","$scope","$http","$location","$routeParams","ReleaseService","GenresService","ThemesService","Restangular","limitToFilter",function(a,b,c,d,e,f,g,h,i,j){b.releaseSearchFormData={},a.releaseParams&&(b.releases=f.query(a.releaseParams,function(){b.predicate="release_year",b.releaseSearchFormData=a.releaseParams,delete a.releaseParams})),b.ausnz=["A","NZ"],b.format=["CD","DIGITAL","VINYL"],b.extendedFormats=[{format_srch:"CD",format_desc:"CD"},{format_srch:"DIGITAL",format_desc:"DIGITAL"},{format_srch:"LP",format_desc:"VINYL LP"},{format_srch:'7"',format_desc:'VINYL 7"'}],b.genres=g.query(),b.themes=h.query(),b.artists=function(a){return c.get("http://db.4zzzfm.org.au/api/v1/artistsuggest/"+a).then(function(a){return j(a.data,15)})},b.titles=function(a){return c.get("http://db.4zzzfm.org.au/api/v1/titlesuggest/"+a).then(function(a){return j(a.data,15)})},b.search=function(){if(b.releaseSearchForm.$dirty===!0){var c=b.releaseSearchFormData;b.releases=f.query(c,function(){b.predicate="release_year",b.artistname=e.name,a.releaseParams=c})}else console.log("no search shit!")},b.clearForm=function(){b.releaseSearchFormData={},b.releaseSearchFormData.title="",b.releaseSearchFormData.artist_nm="",b.releaseSearchForm.$setPristine(),delete a.releaseParams,b.releases={}},b.add=function(){b.releaseSearchFormData.artist_nm?d.path("/releases/new/"+b.releaseSearchFormData.artist_nm):d.path("/releases/new/release")}}]),angular.module("zeddbApp").controller("ReleaseDetailCtrl",["$rootScope","$scope","$routeParams","Restangular","ReleaseService","GenresService","ThemesService","SubsBandService","$dialog","$location",function(a,b,c,d,e,f,g,h,i,j){b.alerts=[],b.ausnz=["A","NZ"],b.promo=["Promo Campaign","Staff Pick","Other"],b.format=["CD","DIGITAL","VINYL"],b.status=["In Library","Received","Culled","Rejected"],b.genres=f.query(),b.themes=g.query(),b.release=c.id?e.get({id:c.id},function(a){b.subscriber=h.get({name:a.artist_nm})}):new e,c.name&&(b.release.artist_nm=c.name),b.saveRelease=function(){c.id?b.release.$update({id:c.id},function(){b.alerts.length>0&&b.alerts.splice(0,1),b.alerts.push({msg:"Record "+b.release.library_no+" Updated!"}),b.release=e.get({id:c.id})},function(){alert("Couldnt update!")}):(b.release,b.release.$save(function(){alert("Record added"),j.path("/releases")}))},b.deleteRelease=function(){var a="Warning",d="Are you sure you wish to delete this record?",e=[{result:"cancel",label:"Cancel"},{result:"ok",label:"OK",cssClass:"btn-primary"}];i.messageBox(a,d,e).open().then(function(a){"ok"===a&&b.release.$delete({id:c.id},function(){alert("Record deleted"),j.path("/releases")})})},b.closeAlert=function(a){b.alerts.splice(a,1)},b.add=function(){b.release.artist_nm?j.path("/releases/new/"+b.release.artist_nm):j.path("/releases/new/release")}}]),angular.module("zeddbApp").controller("SubscriberCtrl",["$rootScope","$scope","$http","$location","$routeParams","Restangular","SubService","limitToFilter",function(a,b,c,d,e,f,g,h){b.subscriberSearchFormData={},a.subscriberParams&&(b.subscribers=g.query(a.subscriberParams,function(){b.predicate="createddate",b.subscriberSearchFormData.subName=a.subName,delete a.subscriberParams,delete a.subName})),b.subsuggest=function(a){return c.get("http://db.4zzzfm.org.au/api/v1/subsuggest/"+a).then(function(a){return h(a.data,15)})},b.search=function(){if(b.subscriberSearchForm.$dirty===!0){if(b.subscriberSearchFormData.subName){Object.defineProperty(b.subscriberSearchFormData,"operator",{value:"AND",writable:!0,enumerable:!0,configurable:!0});var c=/,\s*/;if(-1!==b.subscriberSearchFormData.subName.search(c)){var d=b.subscriberSearchFormData.subName.split(c);d.reverse(),b.subscriberSearchFormData.subfirstname=d[0],b.subscriberSearchFormData.sublastname=d[1]}else{var e=/\s/;if(-1!==b.subscriberSearchFormData.subName.search(e)){var d=b.subscriberSearchFormData.subName.split(e);b.subscriberSearchFormData.subfirstname=d[0],b.subscriberSearchFormData.sublastname=d[1],b.subscriberSearchFormData.operator="AND"}else b.subscriberSearchFormData.subfirstname=b.subscriberSearchFormData.subName,b.subscriberSearchFormData.sublastname=b.subscriberSearchFormData.subName,b.subscriberSearchFormData.operator="OR"}}var f=b.subscriberSearchFormData;a.subName=f.subName,delete f.subName,b.subscribers=g.query(f,function(){b.predicate="createddate",a.subscriberParams=b.subscriberSearchFormData})}else console.log("no search shit!")},b.clearForm=function(){delete a.subscriberParams,delete a.subName,b.subscribers={},b.subscriberSearchFormData={},b.subscriberSearchFormData.subName="",b.subscriberSearchForm.$setPristine()},b.add=function(){d.path("/subscribers/new/subscriber")}}]),angular.module("zeddbApp").controller("SubdetailsCtrl",["$rootScope","$scope","$http","$routeParams","Restangular","SubService","SkillsService","ProgramsService","SubsBandService","SubtypesService","$dialog","$location","limitToFilter",function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.alerts=[],b.gender=[{id:1,desc:"MALE"},{id:2,desc:"FEMALE"},{id:3,desc:"TRANS"}],b.sub=d.id?f.get({id:d.id},function(){}):new f,b.suburbsuggest=function(a){return c.get("http://db.4zzzfm.org.au/api/v1/suburbsuggest/"+a).then(function(a){return m(a.data,15)})},b.postcodesuggest=function(a){return c.get("http://db.4zzzfm.org.au/api/v1/postcodesuggest/"+a).then(function(a){return m(a.data,15)})},b.skills=g.query(),b.programs=h.query(),b.subtypes=j.query(),b.saveSubscriber=function(){d.id?(delete b.sub.suburb,b.sub.$update({id:d.id},function(){b.alerts.length>0&&b.alerts.splice(0,1),b.alerts.push({msg:"Subscriber "+b.sub.subnumber+" Updated!"}),b.sub=f.get({id:d.id})},function(){console.log("Couldnt update!")})):(delete b.sub.suburb,console.log(b.sub),b.sub.$save(),alert("Subscriber added."),l.path("/subscribers/"))},b.deleteSubscriber=function(){var c="Warning",e="Are you sure you wish to delete this record?",f=[{result:"cancel",label:"Cancel"},{result:"ok",label:"OK",cssClass:"btn-primary"}];k.messageBox(c,e,f).open().then(function(c){"ok"===c&&b.sub.$delete({id:d.id},function(){a.subscriberParams={},alert("Record deleted."),l.path("/subscribers/")})})},b.closeAlert=function(a){b.alerts.splice(a,1)},b.onSuburbChange=function(a){b.sub.suburbid=a.suburbid,b.sub.suburb.postcode=a.postcode,b.sub.suburb.state=a.state}}]),angular.module("zeddbApp").controller("ContactCtrl",["$rootScope","$scope","$http","$location","$routeParams","Restangular","ContactService","DepartmentsService","limitToFilter",function(a,b,c,d,e,f,g,h,i){b.contactSearchFormData={},a.contactParams&&(b.contacts=g.query(a.contactParams,function(){b.predicate="createddate",b.contactSearchFormData=a.contactParams,delete a.contactParams})),b.contactsuggest=function(a){return c.get("http://db.4zzzfm.org.au/api/v1/contactsuggest/"+a).then(function(a){return i(a.data,15)})},b.departments=h.query(),b.search=function(){if(b.contactSearchForm.$dirty===!0){var c=b.contactSearchFormData;b.contacts=g.query(c,function(){b.predicate="createddate",a.contactParams=c})}else console.log("no search shit!")},b.clearForm=function(){b.contactSearchFormData.org_nm="",b.contactSearchForm.$setPristine(),delete a.contactParams,b.contacts={}},b.add=function(){d.path("/contacts/new/contact")}}]),angular.module("zeddbApp").controller("ContactdetailsCtrl",["$scope","$routeParams","$http","ContactService","DepartmentsService","InterestsService","$dialog","$location","limitToFilter",function(a,b,c,d,e,f,g,h,i){a.alerts=[],a.contact=b.id?d.get({id:b.id},function(){}):new d,a.suburbsuggest=function(a){return c.get("http://db.4zzzfm.org.au/api/v1/suburbsuggest/"+a).then(function(a){return i(a.data,15)})},a.departments=e.query(),a.interests=f.query(),a.saveContact=function(){b.id?a.contact.$update({id:b.id},function(){a.alerts.length>0&&a.alerts.splice(0,1),a.alerts.push({msg:"Contact "+b.id+" Updated!"}),a.contact=d.get({id:b.id})},function(){console.log("Couldnt update!")}):(a.contact.$save(),alert("Contact added"),h.path("/contacts"))},a.deleteContact=function(){var c="Warning",d="Are you sure you wish to delete this record?",e=[{result:"cancel",label:"Cancel"},{result:"ok",label:"OK",cssClass:"btn-primary"}];g.messageBox(c,d,e).open().then(function(c){"ok"===c&&a.contact.$delete({id:b.id},function(){alert("Record deleted"),h.path("/contacts")})})},a.closeAlert=function(b){a.alerts.splice(b,1)},a.onSuburbChange=function(b){a.contact.postcode=b.postcode,a.contact.state=b.state}}]);